<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Yubikey Make New Master Key</title>
	<meta name='Generator' content='Zim 0.69'>
	<style type='text/css'>
		a          { color: #690303; text-decoration: none      }
		a:hover    { text-decoration: underline }
		a:active   { text-decoration: underline }
		strike     { color: grey                }
		u          { text-decoration: none;
					 background-color: yellow   }
		tt         { color: #2e3436;            }
		pre        { color: #2e3436;
					 margin-left: 20px          }
		h1         { text-decoration: underline;
					 color: #690303; margin-bottom: 0 }
		h2         { color: #690303; margin-bottom: 0 }
		h3         { color: #690303; margin-bottom: 0 }
		h4         { color: #690303; margin-bottom: 0 }
		h5         { color: #690303; margin-bottom: 0 }
		p          { margin-top: 0              }
		span.zim-tag {
			color: #ce5c00;
		}
		div.zim-object {
			border-style:solid;
			border-width:1px;
		}
		.checked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8sMEGsKGkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEBUlEQVRIx62V22tdRRTGf7Nn73P2ybntnNOe3NqkPTGgLTVUUZF6QatSLOKTPgqCIqLgQ0H/A1sQQbBYCBb1QfAxiC8tSO1FqHkwJVKtjdTGNraUmObsc9nXmfGh7cGYpM1D5nHWzPetteZb3wg2eB2YqYm4zSadsMtoboiNBH/3TE0awx6j+MRoxoTg/IYRvP19TQrJS0bzhdHGSyKFkLTtjSKwMjyiEz43ynhtP6bdjBCWyFobAf7eT7VhNF/q1FRbjYjmUohlCVPwnB+6FUxMTJipqSmUUhhjEGKd3bMT4ks/Y6oLBK2Yth8hHYtCJXOix7Nf7xLMzc0xOzvLzp078TyPNE3viW3QJPXzhNWbxFFKHCmMhoLn/FHodd48vGfhapdAacXQlkFK5dL6wIUm6fuTZPuvqDQhaMUYYyiVyuQr6rXDexYuAdi3tSv1ZJNs/R/CaszzT+1na88uXFnCEnJVgivBNN8uTJKmHQI/ptOOcXNZzMz9mOqFs90OHpipWcYwlo5P4ebnuOkrvr5wgrH+h3im7y36MzuwRXYZeKha/OhP0EkadFoxQSdGSotedR/+XwMc2XvKdNUFOFqZx6LKZWIiwjgkikNmLp/hm8sH+K1zjFTHXfBYdTi+eJArzXM0GxFxoBDCopLvo/fqEwi1XPkWkGqjFo2TgB1jOYZUKZTS/D1/ncmLh7jon0IbRWoiTi59ymzzJEEQE3cStNZsGxqlfPE57MBbOR8fP3hDGalOO9fq2DlBvmZw8xa2IxACGn6TydlD/O6f5OzSV/zif0cYhLQaEXGkKBbz7Ov/AOlXV1cxgBJRI3fuSTrpTawt18kWIZN1CFuaONI0w0WOXfsI43YIggh/KUSlhqxrMz74AkOZcWBm9QkH+Gw8NDLuITi+m0yzhluSyJzBLcpblUhFxywSRAEtPwQjsKVN30CNh0uvYuOubSHLtN3J0TO1j0pmBNuFbFWRK0gyPRZpktL2I5JQkclKakNlnh54g6ocvevUr/Ai2a7wineEkcJupA3S1Wg0nVZM2E6wbEF5U5G9Q++wI7sfR7h3N8HVNstykBfzH+KJEZwiWD0aIwxCgJ0R1Mu7GXOeJSuK93bZtQIle4D9pUNU5DC5jEsu55AvZakM5NicGyEj8uuz8bUCQgj67QfY671P3vEoeC69gy695U1U7NG7XV0pUwBjDJa1/JJlWWxzHuflzQe5FJ/GsgUVuZ2t8lEkTvfc0aNHb72flBhjVicQQqCUuvM3/M+WDVguWBrMVdDXEGZlBVEUrVCU9d9s5+fnaTQa2PZyPxEIhJaI1EEoZwX4ncynp6fXrmB4eJjR0VFarRbNZnP9P9rt9gohqNVq1Ov1ZbF/AZGev3hLJ2/zAAAAAElFTkSuQmCC)}
		.xchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8bDYnDxEwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEK0lEQVRIx9WVS2hTWRjHf/eR3CY1nbxMH2YiZRQS6qO13YlMVxY3SnVcuNIBFezGpSADLoQqLu1sHJCqdCFSXFpw4YOCSH3BtFqttTNamabX3DS5bfO6uffMoglja3RGcDMHzuac7/z/53++//cd+L8P6VuCPQYZ8ADNgBd4J31DcDcQs+GnHByRocEDv0kfBSjAOlYCs11Q+gpwDegS8LMJ+3QIK0ATzEhV8Odnz5bzw8P4dJ25aJQ/WlvJ1df/K7hSLtOcTNI+Pk69rpMTgqIQhCDvh1/VSpw79+gRrRMTmLZNezLJJsPg+a5dmOEwQlFqg1sWG16/Jv7sGWXDwBACFQjC9HcwIMONKkGp4PGAJGEDS0IQmZlhnWnye3c3eiyGo6qr3WHbrJ+dJf7gAXI6zSIr72T7/fgzmT4FHnTBsgrQBfYvTU0km5vxz86iADnAm0rRPTWFt7cXZccOJJcLAGHb2K9ekT93jmwmwwdAAFpjI6Ntbfxw5879ag7l6o1sr5eHHR3IsRgeQK/M4sQE+YEB7JcvEY6zAj45SWFgAPPxYwzHoQxIkQjTPT0kIxE+Noj8sexFn4/xnh58iQTeSpHkHAdrbIzi0BCOrmNPTpK/eJHM3bt8sCyKQCiR4NWePWSiUZw1+ZLXJm4pFKLhzBlCsRh2RUXacVgeGaF47RrL58+zcP8+RrmMkCQinZ1EL1zAjERqmkH+tLYl1G3bCJw4QUjT0IA0MJfLMX/5MqmHD0nZNiUgtGULG/r7ccXjINWuWbnmqsuFu7sb/4EDNLlcBIEioNs2KUAFGmMxmk6dQm1tRZI+3xBqEkiShBQOox05Ql1nJ26gvuIUAWiKQnj/ftStW5Fk+YuF+NldsbBA4cYN9KdPmaso8Fc62ZJtk7l1C2t0FGdxESHE1xE4hkHh6lX0oSHSpRIewC/LrPf7CSgKNpCamkI/fZr8pUuIZBIcpyaBunahPp1mub+fDyMjGKUSChCsq6Nh717q9u2jbnSU0uAgRrFIwTThyhUCqRS+hgZKLS1fJvDm87SNjZGcnsYUAjcQ8vsJ9/Xh7u1FDgRQN20iks3iDA+zZFmYhQLqzZtsj8WY3L0baY2Sf55ICCKpFHUzM2SEQAJCHg+hY8fQDh5EDgRWDoRC1J88SePRo2geD0XAcBy8b98Sv3ePYDZbbf2rFQjLIphMsmDbaEBQVQkePox26BCSz7e6i4bDrDt+nGYhmBscpFAskheC4Js3bPR4qHphFYEnlcI7P4/jdqNpGu8TCe4oCsXr1z//F2ga3+/cSfTJE0qmSVYIsKzaOZDcbjKyzFIiwfvt21kMBLA07YsetzWNd+3tLLW0sH5igvT8PH9Go/z44kX+E4LGjg7GDYOcy4XlOEgLC//5P/5LCFzxOPLmzWyIx+m6fduu7v0NVGqyTSycKksAAAAASUVORK5CYII=)}
		.unchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8qAt8h3m8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA60lEQVRIx+2VsQqDMBRF70sCLg5OLoKgjk7+lJ/hh+STXBwcnRz8ArMEkrxOFktbaC3tULzTg5e8k5vADXDq70VbobXmvu/hvQczg4heHrJfXxQFuq67blZbMc8zpmlCXddIkgTOuZcBUko45zCOI6y1Nz2xFSEEZFmGOI7fGg4A3nsQEZqmuXOu9jallACAtm3fvmutNaIoAjM/dkBECCF89KCbk4eAb+kEnIAT8EsAM0OIz3hSyrssUvss8t5fg+uIrLXPs0gIgWVZYIyBUurQyYdheO4gz3NUVQVjDNZ1PfSjpWmKsixvehfB9GBZ3NndrgAAAABJRU5ErkJggg==)}
		.migrated-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB+AKHREFA8vJSnkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAC1klEQVRIx+2VT0hUURTGf/e958w4Tc3TYowMw1GyEgwr1MqsFmbZIrIWQZsWJUjbdoHQpl3Qps0swnCRECQFYkR/TC1iKkqmfzAKTo2Vf8hoRsfR995tkRMT87RRWkUHHhy495zvnvvu933wP/75EKkkEAjIYDCIaZpIKRFCZN0kfX9xcTGtra2/irVUEolECIfDlJeXo+s6hmFkDaCqKoZhEAqFSCaTv60pqcSyLAoLC/F4PEtqDmCaJkIIKisrMybX0sdUVRWA5ubmPzdNjjI1cpXkZC/O1fV03PXgdDqRUtpPIITAsqxsDz0Z/3CZQv8uqo4N4C8/Tp2/DdM0MiZQlvk41OTkI/LW1SGtCVb5drD3eCc71wcA+VcAHA5vDd8+3UGakxiJV7i9pdQevU5T1R35pJ3MV5QW1pf+0kWBheJ2SWua8EQXZXsu4fVVYEz1sEKvof5EuxjoPvzpcRvrdp9C2gGMx6cpOHBmbImMesds7BZubwMVDTfXDnQ3vQfK7AC8wLfExMX5whyQc3q2OEnjGm5vE76SQxsfBLr77a7CNf+n0r/l6sSMtsBSnurckiIILCobAtVZhpF4gZF4jubaymj4Ch/fd380LE7bAnjc0NPxk2yqpmEuwGxF0ag+0k5uTpzZeBeaazvj0We8fXojainsb2xh2BZgbe0gSIllzSIUh63wfQ6dZ/O2fbjcKlOj58jJ3cVENESw5yErc9nf2MLQ4jwQAkV1Lqiq37/cZ9WaahJjF9AcmxiPDhLs7ePe23oOnmUwg2hSShQle96tKDjA2HAniusgo9FxnvY9Jxw7RWzGYy92QghM00x5g53qp9sHmtB58/o2umOI2NwGolMnMYUHIb7aAyiKwsjICLqu2/qBEIKUUAohMaSHSLyBSMoPTINQ6CX5+fn2AEVFRZSUlBCPx4nFYhl3L4RESjF/GEgX3pSj+Xw+/H7/b3U/AEOZFnp7O5+5AAAAAElFTkSuQmCC)}
		ul {list-style-image: none}
		/* ul rule needed to reset style for sub-bullets */
	</style>
</head>
<body>

<!-- Wiki content -->

	<img src="https://storage.googleapis.com/stiles-images/StilesLogo.png" alt="Stiles Logo" />
	<h1>Yubikey Make New Master Key</h1>

<br>
<br>
<br>
<br>

<p>
Content-Type: text/x-zim-wiki Wiki-Format: zim 0.4
</p>

<br>

<p>
Yubikey Make New Master Key
</p>

<br>

<p>
Created Sunday 20 May 2018
</p>

<br>
<br>

<p>
Create temporary working directory for GPG<br>
Create a directory in /tmp which won't survive a reboot:
</p>

<br>
<br>

<p>
$ export GNUPGHOME=$(mktemp -d) ; echo $GNUPGHOME<br>
/tmp/tmp.aaiTTovYgo
</p>

<br>

<p>
Create configuration
</p>

<p>
Paste the following text into a terminal window to create a recommended GPG configuration:
</p>

<br>
<br>
<br>

<p>
  cat &lt;&lt; EOF &gt; $GNUPGHOME/gpg.conf<br>
use-agent<br>
personal-cipher-preferences AES256 AES192 AES CAST5<br>
personal-digest-preferences SHA512 SHA384 SHA256 SHA224<br>
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed<br>
cert-digest-algo SHA512<br>
s2k-digest-algo SHA512<br>
s2k-cipher-algo AES256<br>
charset utf-8<br>
fixed-list-mode<br>
no-comments<br>
no-emit-version<br>
keyid-format 0xlong<br>
list-options show-uid-validity<br>
verify-options show-uid-validity<br>
with-fingerprint<br>
EOF
</p>

<br>
<br>
<br>

<p>
  Create master key
</p>

<p>
  A note on key expiry: setting an expiry essentially forces you to manage your subkeys and announces to the rest<br>
<div style='padding-left: 30pt'>
of the world that you are doing so. Setting an expiry on a primary key is ineffective for protecting the key from<br>
loss - whoever has the primary key can simply extend its expiry period. Revocation certificates are better suited<br>
for this purpose. It may be appropriate for your use case to set expiry dates on subkeys.
</div>
</p>

<br>
<br>
<br>

<p>
  Generate a new key with GPG, selecting RSA (sign only) and the appropriate keysize:<br>
  gpg --full-generate-key
</p>

<br>
<br>

<p>
  Please select what kind of key you want:<br>
  (1) RSA and RSA (default)<br>
  (2) DSA and Elgamal<br>
  (3) DSA (sign only)<br>
  (4) RSA (sign only)<br>
  Your selection? 4<br>
  RSA keys may be between 1024 and 4096 bits long.<br>
  What keysize do you want? (2048) 4096<br>
  Requested keysize is 4096 bits<br>
  Please specify how long the key should be valid.
</p>

<p>
<div style='padding-left: 30pt'>
0 = key does not expire
</div>
</p>

<br>

<p>
<div style='padding-left: 30pt'>
  &lt;n&gt; = key expires in n days<br>
  &lt;n&gt;w = key expires in n weeks<br>
  &lt;n&gt;m = key expires in n months<br>
  &lt;n&gt;y = key expires in n years
</div>
</p>

<p>
<div style='padding-left: 30pt'>
  Key is valid for? (0) 0<br>
  Key does not expire at all<br>
  Is this correct? (y/N) y
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 30pt'>
  GnuPG needs to construct a user ID to identify your key.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 30pt'>
  Real name: Dr Duh<br>
  Email address: <a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a><br>
  Comment:<br>
  You selected this USER-ID:
</div>
</p>

<p>
<div style='padding-left: 60pt'>
"Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;"
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 60pt'>
Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 60pt'>
You'll be prompted to enter and verify a passphrase. Keep the passphrase handy as you'll need it throughout.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 60pt'>
We need to generate a lot of random bytes. It is a good idea to perform<br>
some other action (type on the keyboard, move the mouse, utilize the<br>
disks) during the prime generation; this gives the random number<br>
generator a better chance to gain enough entropy.<br>
gpg: /tmp.FLZC0xcM/trustdb.gpg: trustdb created<br>
gpg: key 0xFF3E7D88647EBCDB marked as ultimately trusted<br>
gpg: directory '/tmp.FLZC0xcM/openpgp-revocs.d' created<br>
gpg: revocation certificate stored as<br>
'/tmp.FLZC0xcM/openpgp-revocs.d/011CE16BD45B27A55BA8776DFF3E7D88647EBCDB.rev'<br>
public and secret key created and signed.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 60pt'>
Note that this key cannot be used for encryption. You may want to use<br>
the command "--edit-key" to generate a subkey for this purpose.<br>
pub rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [SC]
</div>
</p>

<p>
<div style='padding-left: 60pt'>
  Key fingerprint = 011C E16B D45B 27A5 5BA8 776D FF3E 7D88 647E BCDB
</div>
</p>

<p>
<div style='padding-left: 60pt'>
  uid Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;
</div>
</p>

<br>

<p>
<div style='padding-left: 60pt'>
  Save Key ID
</div>
</p>

<p>
<div style='padding-left: 60pt'>
  Export the key ID as a variable for use throughout:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 60pt'>
  $ export KEYID=0xFF3E7D88647EBCDB
</div>
</p>

<br>

<p>
<div style='padding-left: 60pt'>
  Create subkeys
</div>
</p>

<p>
<div style='padding-left: 60pt'>
  Note: If using a Yubikey 4, please use 4096 bit as the size for the subkeys; if using a YubiKey Neo,
</div>
<div style='padding-left: 90pt'>
please use<br>
2048 bit as the size for the subkeys.
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 60pt'>
  Edit the key to add subkeys:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 60pt'>
  $ gpg --expert --edit-key $KEYID
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 60pt'>
  Secret key is available.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 60pt'>
  sec rsa4096/0xEA5DE91459B80592
</div>
</p>

<p>
<div style='padding-left: 90pt'>
created: 2017-10-09 expires: never usage: SC<br>
trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 90pt'>
[ultimate] (1). Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;
</div>
</p>

<br>

<p>
<div style='padding-left: 90pt'>
Signing key
</div>
</p>

<p>
<div style='padding-left: 90pt'>
First, create a signing key, selecting RSA (sign only):
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 90pt'>
gpg&gt; addkey<br>
Key is protected.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 90pt'>
You need a passphrase to unlock the secret key for<br>
user: "Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;"<br>
4096-bit RSA key, ID 0xFF3E7D88647EBCDB, created 2016-05-24
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 90pt'>
Please select what kind of key you want:<br>
(3) DSA (sign only)<br>
(4) RSA (sign only)<br>
(5) Elgamal (encrypt only)<br>
(6) RSA (encrypt only)<br>
(7) DSA (set your own capabilities)<br>
(8) RSA (set your own capabilities)<br>
Your selection? 4<br>
RSA keys may be between 1024 and 4096 bits long.<br>
What keysize do you want? (2048) 4096<br>
Requested keysize is 4096 bits<br>
Please specify how long the key should be valid.
</div>
</p>

<p>
<div style='padding-left: 90pt'>
  0 = key does not expire
</div>
</p>

<br>

<p>
<div style='padding-left: 120pt'>
&lt;n&gt; = key expires in n days<br>
&lt;n&gt;w = key expires in n weeks<br>
&lt;n&gt;m = key expires in n months<br>
&lt;n&gt;y = key expires in n years
</div>
</p>

<p>
<div style='padding-left: 120pt'>
Key is valid for? (0) 0<br>
Key does not expire at all<br>
Is this correct? (y/N) y<br>
Really create? (y/N) y<br>
We need to generate a lot of random bytes. It is a good idea to perform<br>
some other action (type on the keyboard, move the mouse, utilize the<br>
disks) during the prime generation; this gives the random number<br>
generator a better chance to gain enough entropy.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 120pt'>
sec rsa4096/0xFF3E7D88647EBCDB
</div>
</p>

<p>
<div style='padding-left: 120pt'>
  created: 2017-10-09 expires: never usage: SC<br>
  trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 120pt'>
  ssb rsa4096/0xBECFA3C1AE191D15
</div>
</p>

<p>
<div style='padding-left: 150pt'>
created: 2017-10-09 expires: never usage: S
</div>
</p>

<p>
<div style='padding-left: 150pt'>
[ultimate] (1). Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;
</div>
</p>

<br>

<p>
<div style='padding-left: 150pt'>
Encryption key
</div>
</p>

<p>
<div style='padding-left: 150pt'>
Next, create an encryption key, selecting RSA (encrypt only):
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 150pt'>
gpg&gt; addkey<br>
Please select what kind of key you want:<br>
(3) DSA (sign only)<br>
(4) RSA (sign only)<br>
(5) Elgamal (encrypt only)<br>
(6) RSA (encrypt only)<br>
(7) DSA (set your own capabilities)<br>
(8) RSA (set your own capabilities)<br>
(10) ECC (sign only)<br>
(11) ECC (set your own capabilities)<br>
(12) ECC (encrypt only)<br>
(13) Existing key<br>
Your selection? 6<br>
RSA keys may be between 1024 and 4096 bits long.<br>
What keysize do you want? (2048) 4096<br>
Requested keysize is 4096 bits<br>
Please specify how long the key should be valid.
</div>
</p>

<p>
<div style='padding-left: 150pt'>
  0 = key does not expire
</div>
</p>

<br>

<p>
<div style='padding-left: 180pt'>
&lt;n&gt; = key expires in n days<br>
&lt;n&gt;w = key expires in n weeks<br>
&lt;n&gt;m = key expires in n months<br>
&lt;n&gt;y = key expires in n years
</div>
</p>

<p>
<div style='padding-left: 180pt'>
Key is valid for? (0) 0<br>
Key does not expire at all<br>
Is this correct? (y/N) y<br>
Really create? (y/N) y<br>
We need to generate a lot of random bytes. It is a good idea to perform<br>
some other action (type on the keyboard, move the mouse, utilize the<br>
disks) during the prime generation; this gives the random number<br>
generator a better chance to gain enough entropy.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 180pt'>
sec rsa4096/0xFF3E7D88647EBCDB
</div>
</p>

<p>
<div style='padding-left: 180pt'>
  created: 2017-10-09 expires: never usage: SC<br>
  trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 180pt'>
  ssb rsa4096/0xBECFA3C1AE191D15
</div>
</p>

<p>
<div style='padding-left: 210pt'>
created: 2017-10-09 expires: never usage: S
</div>
</p>

<p>
<div style='padding-left: 210pt'>
ssb rsa4096/0x5912A795E90DD2CF
</div>
</p>

<p>
<div style='padding-left: 210pt'>
  created: 2017-10-09 expires: never usage: E
</div>
</p>

<p>
<div style='padding-left: 210pt'>
  [ultimate] (1). Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;
</div>
</p>

<br>

<p>
<div style='padding-left: 210pt'>
  Authentication key
</div>
</p>

<p>
<div style='padding-left: 210pt'>
  Finally, create an authentication key.
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 210pt'>
  GPG doesn't provide a 'RSA (authenticate only)' key type out of the box, so select 'RSA<br>
  (set your own<br>
  capabilities)' and toggle the required capabilities to end up with an Authenticate-only<br>
  key:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  gpg&gt; addkey<br>
  Please select what kind of key you want:<br>
  (3) DSA (sign only)<br>
  (4) RSA (sign only)<br>
  (5) Elgamal (encrypt only)<br>
  (6) RSA (encrypt only)<br>
  (7) DSA (set your own capabilities)<br>
  (8) RSA (set your own capabilities)<br>
  (10) ECC (sign only)<br>
  (11) ECC (set your own capabilities)<br>
  (12) ECC (encrypt only)<br>
  (13) Existing key<br>
  Your selection? 8
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Possible actions for a RSA key: Sign Encrypt Authenticate<br>
  Current allowed actions: Sign Encrypt
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  (S) Toggle the sign capability<br>
  (E) Toggle the encrypt capability<br>
  (A) Toggle the authenticate capability<br>
  (Q) Finished
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Your selection? S
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Possible actions for a RSA key: Sign Encrypt Authenticate<br>
  Current allowed actions: Encrypt
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  (S) Toggle the sign capability<br>
  (E) Toggle the encrypt capability<br>
  (A) Toggle the authenticate capability<br>
  (Q) Finished
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Your selection? E
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Possible actions for a RSA key: Sign Encrypt Authenticate<br>
  Current allowed actions:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  (S) Toggle the sign capability<br>
  (E) Toggle the encrypt capability<br>
  (A) Toggle the authenticate capability<br>
  (Q) Finished
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Your selection? A
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Possible actions for a RSA key: Sign Encrypt Authenticate<br>
  Current allowed actions: Authenticate
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  (S) Toggle the sign capability<br>
  (E) Toggle the encrypt capability<br>
  (A) Toggle the authenticate capability<br>
  (Q) Finished
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 210pt'>
  Your selection? q<br>
  RSA keys may be between 1024 and 4096 bits long.<br>
  What keysize do you want? (2048) 4096<br>
  Requested keysize is 4096 bits<br>
  Please specify how long the key should be valid.
</div>
</p>

<p>
<div style='padding-left: 240pt'>
0 = key does not expire
</div>
</p>

<br>

<p>
<div style='padding-left: 240pt'>
  &lt;n&gt; = key expires in n days<br>
  &lt;n&gt;w = key expires in n weeks<br>
  &lt;n&gt;m = key expires in n months<br>
  &lt;n&gt;y = key expires in n years
</div>
</p>

<p>
<div style='padding-left: 240pt'>
  Key is valid for? (0) 0<br>
  Key does not expire at all<br>
  Is this correct? (y/N) y<br>
  Really create? (y/N) y<br>
  We need to generate a lot of random bytes. It is a good idea to perform<br>
  some other action (type on the keyboard, move the mouse, utilize the<br>
  disks) during the prime generation; this gives the random number<br>
  generator a better chance to gain enough entropy.
</div>
</p>

<br>
<br>
<br>
<br>

<p>
<div style='padding-left: 240pt'>
  sec rsa4096/0xFF3E7D88647EBCDB
</div>
</p>

<p>
<div style='padding-left: 270pt'>
created: 2017-10-09 expires: never usage: SC<br>
trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 270pt'>
ssb rsa4096/0xBECFA3C1AE191D15
</div>
</p>

<p>
<div style='padding-left: 270pt'>
  created: 2017-10-09 expires: never usage: S
</div>
</p>

<p>
<div style='padding-left: 270pt'>
  ssb rsa4096/0x5912A795E90DD2CF
</div>
</p>

<p>
<div style='padding-left: 300pt'>
created: 2017-10-09 expires: never usage: E
</div>
</p>

<p>
<div style='padding-left: 300pt'>
ssb rsa4096/0x3F29127E79649A3D
</div>
</p>

<p>
<div style='padding-left: 300pt'>
  created: 2017-10-09 expires: never usage: A
</div>
</p>

<p>
<div style='padding-left: 300pt'>
  [ultimate] (1). Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 300pt'>
  gpg&gt; save
</div>
</p>

<br>

<p>
<div style='padding-left: 300pt'>
  Check your work
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 300pt'>
  List your new secret keys:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 300pt'>
  $ gpg --list-secret-keys<br>
  /tmp.FLZC0xcM/pubring.kbx
</div>
</p>

<br>

<p>
<div style='padding-left: 300pt'>
  &lt;hr&gt;
</div>
</p>

<br>

<p>
<div style='padding-left: 300pt'>
  sec rsa4096/0xFF3E7D88647EBCDB 2017-10-09 [SC]
</div>
</p>

<p>
<div style='padding-left: 330pt'>
Key fingerprint = 011C E16B D45B 27A5 5BA8 776D FF3E 7D88 647E BCDB
</div>
</p>

<p>
<div style='padding-left: 330pt'>
uid Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;<br>
ssb rsa4096/0xBECFA3C1AE191D15 2017-10-09 [S]<br>
ssb rsa4096/0x5912A795E90DD2CF 2017-10-09 [E]<br>
ssb rsa4096/0x3F29127E79649A3D 2017-10-09 [A]
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Verify with OpenPGP key checks:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Use the automated key best practice checker:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ sudo apt-get install hopenpgp-tools<br>
$ gpg --export $KEYID | hokey lint
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
Export keys
</div>
</p>

<p>
<div style='padding-left: 330pt'>
Save a copy of your keys:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ gpg --armor --export-secret-keys $KEYID &gt; $GNUPGHOME/mastersub.key
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ gpg --armor --export-secret-subkeys $KEYID &gt; $GNUPGHOME/sub.key<br>
The exported (primary) key will still have the passphrase in place.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
In addition to the backup below, you might want to keep a separate copy of<br>
the revocation certificate in a safe<br>
place: $GNUPGHOME/openpgp-revocs.d/&lt;key fingerprint&gt;.rev
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
Backup everything
</div>
</p>

<p>
<div style='padding-left: 330pt'>
Once keys are moved to hardware, they cannot be extracted again<br>
  (otherwise, what would be the point?), so make<br>
  sure you have made an encrypted backup before proceeding.
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
Also consider using a paper copy of the keys as an additional backup<br>
measure.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
To create an encrypted USB drive, first attach it and check its label:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ dmesg | tail<br>
[ 7667.607011] scsi8 : usb-storage 2-1:1.0<br>
[ 7667.608766] usbcore: registered new interface driver usb-storage<br>
[ 7668.874016] scsi 8:0:0:0: USB 0: 0 ANSI: 6<br>
[ 7668.874242] sd 8:0:0:0: Attached scsi generic sg4 type 0<br>
[ 7668.874682] sd 8:0:0:0: [sde] 62980096 512-byte logical blocks: (32.2<br>
GB/30.0 GiB)<br>
[ 7668.875022] sd 8:0:0:0: [sde] Write Protect is off<br>
[ 7668.875023] sd 8:0:0:0: [sde] Mode Sense: 43 00 00 00<br>
[ 7668.877939] sde: sde1<br>
[ 7668.879514] sd 8:0:0:0: [sde] Attached SCSI removable disk<br>
Check the size to make sure it's the right drive:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ sudo fdisk -l | grep /dev/sde<br>
Disk /dev/sde: 30 GiB, 32245809152 bytes, 62980096 sectors<br>
/dev/sde1 2048 62980095 62978048 30G 6 FAT16<br>
Erase and create a new partition table:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ sudo fdisk /dev/sde
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Welcome to fdisk (util-linux 2.25.2).<br>
Changes will remain in memory only, until you decide to write them.<br>
Be careful before using the write command.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Command (m for help): o<br>
Created a new DOS disklabel with disk identifier 0xeac7ee35.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Command (m for help): w<br>
The partition table has been altered.<br>
Calling ioctl() to re-read partition table.<br>
Syncing disks.
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
Remove and reinsert the USB drive, then create a new partition,<br>
  selecting defaults::
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ sudo fdisk /dev/sde
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Welcome to fdisk (util-linux 2.25.2).<br>
Changes will remain in memory only, until you decide to write them.<br>
Be careful before using the write command.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Command (m for help): n<br>
Partition type<br>
p primary (0 primary, 0 extended, 4 free)<br>
e extended (container for logical partitions)<br>
Select (default p): p<br>
Partition number (1-4, default 1): 1<br>
First sector (2048-62980095, default 2048):<br>
Last sector, +sectors or +size{K,M,G,T,P} (2048-62980095, default<br>
62980095):
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Created a new partition 1 of type 'Linux' and of size 30 GiB.<br>
Command (m for help): w<br>
The partition table has been altered.<br>
Calling ioctl() to re-read partition table.<br>
Syncing disks.
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
Use LUKS to encrypt the new partition:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ sudo cryptsetup luksFormat /dev/sde1
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
WARNING!<br>
========<br>
This will overwrite data on /dev/sde1 irrevocably.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
Are you sure? (Type uppercase yes): YES<br>
Enter passphrase:<br>
Verify passphrase:
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
Mount the partition:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ sudo cryptsetup luksOpen /dev/sde1 encrypted-usb<br>
Enter passphrase for /dev/sde1:
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
Create a filesystem:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
$ sudo mkfs.ext4 /dev/mapper/encrypted-usb -L encrypted-usb<br>
mke2fs 1.42.12 (29-Aug-2014)<br>
Creating filesystem with 7871744 4k blocks and 1970416 inodes<br>
Superblock backups stored on blocks:
</div>
</p>

<p>
<div style='padding-left: 330pt'>
  32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,<br>
  4096000
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
  Allocating group tables: done<br>
  Writing inode tables: done<br>
  Creating journal (32768 blocks): done<br>
  Writing superblocks and filesystem accounting information: done
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
  Mount the filesystem:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
  $ sudo mkdir /mnt/usb<br>
  $ sudo mount /dev/mapper/encrypted-usb /mnt/usb
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
  Finally, copy files to it:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
  $ sudo cp -avi $GNUPGHOME /mnt/usb<br>
  ‘/tmp/tmp.aaiTTovYgo’ -&gt; ‘/mnt/usb/tmp.aaiTTovYgo’<br>
  ‘/tmp/tmp.aaiTTovYgo/revoke.txt’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/revoke.txt’<br>
  ‘/tmp/tmp.aaiTTovYgo/gpg.conf’ -&gt; ‘/mnt/usb/tmp.aaiTTovYgo/gpg.conf’<br>
  ‘/tmp/tmp.aaiTTovYgo/trustdb.gpg’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/trustdb.gpg’<br>
  ‘/tmp/tmp.aaiTTovYgo/random_seed’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/random_seed’<br>
  ‘/tmp/tmp.aaiTTovYgo/master.key’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/master.key’<br>
  ‘/tmp/tmp.aaiTTovYgo/secring.gpg’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/secring.gpg’<br>
  ‘/tmp/tmp.aaiTTovYgo/mastersub.key’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/mastersub.key’<br>
  ‘/tmp/tmp.aaiTTovYgo/sub.key’ -&gt; ‘/mnt/usb/tmp.aaiTTovYgo/sub.key’<br>
  ‘/tmp/tmp.aaiTTovYgo/pubring.gpg~’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/pubring.gpg~’<br>
  ‘/tmp/tmp.aaiTTovYgo/pubring.gpg’ -&gt;<br>
  ‘/mnt/usb/tmp.aaiTTovYgo/pubring.gpg’
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
  Keep the backup mounted if you plan on setting up two or more keys
</div>
<div style='padding-left: 360pt'>
(as keytocard will delete the local copy on<br>
save), otherwise unmount and disconnected the encrypted USB drive:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 330pt'>
  $ sudo umount /mnt/usb<br>
  $ sudo cryptsetup luksClose encrypted-usb
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
  Configure YubiKey
</div>
</p>

<br>

<p>
<div style='padding-left: 330pt'>
  YubiKey NEOs shipped after November 2015 have all modes enabled, skip to<br>
  the next step.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
  Older versions of the YubiKey NEO may need to be reconfigured as a<br>
  composite USB device (HID + CCID) which allows<br>
  OTPs to be emitted while in use as a smart card.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
  Plug in your YubiKey and configure it:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
  $ ykpersonalize -m82<br>
  Firmware version 4.2.7 Touch level 527 Program sequence 4
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
  The USB mode will be set to: 0x82
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
  Commit? (y/n) [n]: y<br>
  The -m option is the mode command. To see the different modes, enter<br>
  ykpersonalize –help. Mode 82 (in hex) enables<br>
  the YubiKey NEO as a composite USB device (HID + CCID). Once you have<br>
  changed the mode, you need to re-boot the<br>
  YubiKey – so remove and re-insert it.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
  On YubiKey NEO with firmware version 3.3 or higher you can enable<br>
  composite USB device with -m86 instead of -m82.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 330pt'>
  &lt;a href="<a href="https://www.yubico.com/2012/12/yubikey-neo-openpgp/" title="https://www.yubico.com/2012/12/yubikey-neo-openpgp/" class="https">https://www.yubico.com/2012/12/yubikey-neo-openpgp/</a>" title="<a href="https://www.yubico.com/2012/12/yubikey-neo-openpgp/" title="https://www.yubico.com/2012/12/yubikey-neo-openpgp/" class="https">https://www.yubico.com/2012/12/yubikey-neo-openpgp/</a>"
</div>
<div style='padding-left: 360pt'>
class="https"&gt;<a href="https://www.yubico.com/2012/12/yubikey-neo-openpgp/" title="https://www.yubico.com/2012/12/yubikey-neo-openpgp/" class="https">https://www.yubico.com/2012/12/yubikey-neo-openpgp/</a> &lt;a<br>
  href="<a href="https://www.yubico.com/2012/12/yubikey-neo-composite-device/" title="https://www.yubico.com/2012/12/yubikey-neo-composite-device/" class="https">https://www.yubico.com/2012/12/yubikey-neo-composite-device/</a>"<br>
  title="<a href="https://www.yubico.com/2012/12/yubikey-neo-composite-device/" title="https://www.yubico.com/2012/12/yubikey-neo-composite-device/" class="https">https://www.yubico.com/2012/12/yubikey-neo-composite-device/</a>"<br>
  class="https"&gt;<a href="https://www.yubico.com/2012/12/yubikey-neo-composite-device/" title="https://www.yubico.com/2012/12/yubikey-neo-composite-device/" class="https">https://www.yubico.com/2012/12/yubikey-neo-composite-device/</a>
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Configure smartcard
</div>
</p>

<p>
<div style='padding-left: 360pt'>
  Use GPG to configure YubiKey as a smartcard:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 360pt'>
  $ gpg --card-edit
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Reader ...........: Yubico Yubikey 4 OTP U2F CCID<br>
  Application ID ...: D2760001240102010006055532110000<br>
  Version ..........: 2.1<br>
  Manufacturer .....: Yubico<br>
  Serial number ....: 05553211<br>
  Name of cardholder: [not set]<br>
  Language prefs ...: [not set]<br>
  Sex ..............: unspecified<br>
  URL of public key : [not set]<br>
  Login data .......: [not set]<br>
  Signature PIN ....: not forced<br>
  Key attributes ...: rsa4096 rsa4096 rsa4096<br>
  Max. PIN lengths .: 127 127 127<br>
  PIN retry counter : 3 3 3<br>
  Signature counter : 0<br>
  Signature key ....: [none]<br>
  Encryption key....: [none]<br>
  Authentication key: [none]<br>
  General key info..: [none]
</div>
</p>

<br>

<p>
<div style='padding-left: 360pt'>
  Change PINs
</div>
</p>

<p>
<div style='padding-left: 360pt'>
  The default PIN codes are 12345678 for the Admin PIN (aka PUK)
</div>
<div style='padding-left: 390pt'>
and 123456 for the PIN. The CCID-mode PINs can be<br>
up to 127 ASCII characters long.
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 360pt'>
  The Admin PIN is required for some card operations, and to unblock a<br>
  PIN that has been entered incorrectly more<br>
  than three times. See the GnuPG documentation on Managing PINs for<br>
  details.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  gpg/card&gt; admin<br>
  Admin commands are allowed
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  gpg/card&gt; passwd<br>
  gpg: OpenPGP card no. D2760001240102010006055532110000 detected
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  1 - change PIN<br>
  2 - unblock PIN<br>
  3 - change Admin PIN<br>
  4 - set the Reset Code<br>
  Q - quit
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Your selection? 3<br>
  PIN changed.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  1 - change PIN<br>
  2 - unblock PIN<br>
  3 - change Admin PIN<br>
  4 - set the Reset Code<br>
  Q - quit
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Your selection? 1<br>
  PIN changed.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  1 - change PIN<br>
  2 - unblock PIN<br>
  3 - change Admin PIN<br>
  4 - set the Reset Code<br>
  Q - quit
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Your selection? q
</div>
</p>

<br>

<p>
<div style='padding-left: 360pt'>
  Set card information
</div>
</p>

<p>
<div style='padding-left: 360pt'>
  Some fields are optional:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 360pt'>
  gpg/card&gt; name<br>
  Cardholder's surname: Duh<br>
  Cardholder's given name: Dr
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  gpg/card&gt; lang<br>
  Language preferences: en
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  gpg/card&gt; login<br>
  Login data (account name): <a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  gpg/card&gt; (Press Enter)
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Application ID ...: D2760001240102010006055532110000<br>
  Version ..........: 2.1<br>
  Manufacturer .....: unknown<br>
  Serial number ....: 05553211<br>
  Name of cardholder: Dr Duh<br>
  Language prefs ...: en<br>
  Sex ..............: unspecified<br>
  URL of public key : [not set]<br>
  Login data .......: <a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a><br>
  Private DO 4 .....: [not set]<br>
  Signature PIN ....: not forced<br>
  Key attributes ...: 2048R 2048R 2048R<br>
  Max. PIN lengths .: 127 127 127<br>
  PIN retry counter : 3 3 3<br>
  Signature counter : 0<br>
  Signature key ....: [none]<br>
  Encryption key....: [none]<br>
  Authentication key: [none]<br>
  General key info..: [none]
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  gpg/card&gt; quit
</div>
</p>

<br>

<p>
<div style='padding-left: 360pt'>
  Transfer keys
</div>
</p>

<p>
<div style='padding-left: 360pt'>
  Transferring keys to YubiKey hardware using keytocard is a
</div>
<div style='padding-left: 390pt'>
one-way operation only, so make sure you've made a<br>
backup before proceeding.
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Previous gpg versions required the toggle command before selecting<br>
  keys. The currently selected key(s) are<br>
  indicated with an *. When moving keys only one key should be selected<br>
  at a time.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  % gpg --edit-key $KEYID
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  Secret key is available.
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 360pt'>
  sec rsa4096/0xFF3E7D88647EBCDB
</div>
</p>

<p>
<div style='padding-left: 390pt'>
created: 2017-10-09 expires: never usage: SC<br>
trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 390pt'>
ssb rsa4096/0xBECFA3C1AE191D15
</div>
</p>

<p>
<div style='padding-left: 390pt'>
  created: 2017-10-09 expires: never usage: S
</div>
</p>

<p>
<div style='padding-left: 390pt'>
  ssb rsa4096/0x5912A795E90DD2CF
</div>
</p>

<p>
<div style='padding-left: 420pt'>
created: 2017-10-09 expires: never usage: E
</div>
</p>

<p>
<div style='padding-left: 420pt'>
ssb rsa4096/0x3F29127E79649A3D
</div>
</p>

<p>
<div style='padding-left: 420pt'>
  created: 2017-10-09 expires: never usage: A
</div>
</p>

<p>
<div style='padding-left: 420pt'>
  [ultimate] (1). Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;
</div>
</p>

<br>

<p>
<div style='padding-left: 420pt'>
  Signature key
</div>
</p>

<p>
<div style='padding-left: 420pt'>
  Select and move the signature key (you will be prompted
</div>
<div style='padding-left: 450pt'>
for the key passphrase and admin PIN):
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 420pt'>
  gpg&gt; key 1
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 420pt'>
  sec rsa4096/0xFF3E7D88647EBCDB
</div>
</p>

<p>
<div style='padding-left: 450pt'>
created: 2017-10-09 expires: never usage: SC<br>
trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 450pt'>
ssb* rsa4096/0xBECFA3C1AE191D15
</div>
</p>

<p>
<div style='padding-left: 450pt'>
  created: 2017-10-09 expires: never usage: S
</div>
</p>

<p>
<div style='padding-left: 450pt'>
  ssb rsa4096/0x5912A795E90DD2CF
</div>
</p>

<p>
<div style='padding-left: 480pt'>
created: 2017-10-09 expires: never usage: E
</div>
</p>

<p>
<div style='padding-left: 480pt'>
ssb rsa4096/0x3F29127E79649A3D
</div>
</p>

<p>
<div style='padding-left: 480pt'>
  created: 2017-10-09 expires: never usage: A
</div>
</p>

<p>
<div style='padding-left: 480pt'>
  [ultimate] (1). Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 480pt'>
  gpg&gt; keytocard<br>
  Please select where to store the key:<br>
  (1) Signature key<br>
  (3) Authentication key<br>
  Your selection? 1
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 480pt'>
  You need a passphrase to unlock the secret key for<br>
  user: "Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;"<br>
  4096-bit RSA key, ID 0xBECFA3C1AE191D15, created<br>
  2016-05-24
</div>
</p>

<br>

<p>
<div style='padding-left: 480pt'>
  Encryption key
</div>
</p>

<p>
<div style='padding-left: 480pt'>
  Type key 1 again to deselect and key 2 to select
</div>
<div style='padding-left: 510pt'>
the next key:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 480pt'>
  gpg&gt; key 1<br>
  ...<br>
  gpg&gt; key 2
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 480pt'>
  sec rsa4096/0xFF3E7D88647EBCDB
</div>
</p>

<p>
<div style='padding-left: 510pt'>
created: 2017-10-09 expires: never usage: SC<br>
trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 510pt'>
ssb rsa4096/0xBECFA3C1AE191D15
</div>
</p>

<p>
<div style='padding-left: 510pt'>
  created: 2017-10-09 expires: never usage: S
</div>
</p>

<p>
<div style='padding-left: 510pt'>
  ssb* rsa4096/0x5912A795E90DD2CF
</div>
</p>

<p>
<div style='padding-left: 540pt'>
created: 2017-10-09 expires: never usage: E
</div>
</p>

<p>
<div style='padding-left: 540pt'>
ssb rsa4096/0x3F29127E79649A3D
</div>
</p>

<p>
<div style='padding-left: 540pt'>
  created: 2017-10-09 expires: never usage:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 540pt'>
  Move the encryption key to card:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 540pt'>
  gpg&gt; keytocard<br>
  Please select where to store the key:<br>
  (2) Encryption key<br>
  Your selection? 2<br>
  ...
</div>
</p>

<br>

<p>
<div style='padding-left: 540pt'>
  Authentication key
</div>
</p>

<p>
<div style='padding-left: 540pt'>
  Type key 2 again to deselect and key 3 to
</div>
<div style='padding-left: 570pt'>
select the next key:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 540pt'>
  gpg&gt; key 2<br>
  ...<br>
  gpg&gt; key 3
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 540pt'>
  sec rsa4096/0xFF3E7D88647EBCDB
</div>
</p>

<p>
<div style='padding-left: 570pt'>
created: 2017-10-09 expires: never usage:<br>
SC<br>
trust: ultimate validity: ultimate
</div>
</p>

<p>
<div style='padding-left: 570pt'>
ssb rsa4096/0xBECFA3C1AE191D15
</div>
</p>

<p>
<div style='padding-left: 570pt'>
  created: 2017-10-09 expires: never usage:<br>
  S
</div>
</p>

<p>
<div style='padding-left: 570pt'>
  ssb rsa4096/0x5912A795E90DD2CF
</div>
</p>

<p>
<div style='padding-left: 600pt'>
created: 2017-10-09 expires: never<br>
usage: E
</div>
</p>

<p>
<div style='padding-left: 600pt'>
ssb* rsa4096/0x3F29127E79649A3D
</div>
</p>

<p>
<div style='padding-left: 600pt'>
  created: 2017-10-09 expires: never<br>
  usage: A
</div>
</p>

<p>
<div style='padding-left: 600pt'>
  [ultimate] (1). Dr Duh<br>
  &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;<br>
  Move the authentication key to card:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 600pt'>
  gpg&gt; keytocard<br>
  Please select where to store the key:<br>
  (3) Authentication key<br>
  Your selection? 3
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 600pt'>
  Save and quit:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 600pt'>
  gpg&gt; save
</div>
</p>

<br>

<p>
<div style='padding-left: 600pt'>
  Check your work
</div>
</p>

<p>
<div style='padding-left: 600pt'>
  ssb&gt; indicates a stub to the
</div>
<div style='padding-left: 630pt'>
private key on smartcard:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 600pt'>
  % gpg --list-secret-keys<br>
  /tmp.FLZC0xcM/pubring.kbx
</div>
</p>

<br>

<p>
<div style='padding-left: 600pt'>
  &lt;hr&gt;
</div>
</p>

<br>

<p>
<div style='padding-left: 600pt'>
  sec rsa4096/0xFF3E7D88647EBCDB<br>
  2017-10-09 [SC]
</div>
</p>

<p>
<div style='padding-left: 630pt'>
Key fingerprint = 011C E16B D45B<br>
27A5 5BA8 776D FF3E 7D88 647E BCDB
</div>
</p>

<p>
<div style='padding-left: 630pt'>
uid Dr Duh &lt;<a href="mailto:doc@duh.to" title="doc@duh.to" class="mailto">doc@duh.to</a>&gt;<br>
ssb&gt; rsa4096/0xBECFA3C1AE191D15<br>
2017-10-09 [S]<br>
ssb&gt; rsa4096/0x5912A795E90DD2CF<br>
2017-10-09 [E]<br>
ssb&gt; rsa4096/0x3F29127E79649A3D<br>
2017-10-09 [A]
</div>
</p>

<br>

<p>
<div style='padding-left: 630pt'>
Export public key
</div>
</p>

<p>
<div style='padding-left: 630pt'>
This file should be publicly<br>
  shared:
</div>
</p>

<br>
<br>
<br>

<p>
<div style='padding-left: 630pt'>
$ gpg --armor --export $KEYID &gt;<br>
/mnt/public-usb-key/pubkey.txt<br>
Optionally, it may be uploaded to a<br>
public keyserver:
</div>
</p>

<br>
<br>

<p>
<div style='padding-left: 630pt'>
$ gpg --send-key $KEYID<br>
gpg: sending key 0xFF3E7D88647EBCDB<br>
to hkps server<br>
hkps.pool.sks-keyservers.net<br>
[...]
</div>
</p>

<br>

<p>
<div style='padding-left: 630pt'>
Finish
</div>
</p>

<p>
<div style='padding-left: 630pt'>
If all went well, you should<br>
  now reboot or securely delete<br>
  $GNUPGHOME.
</div>
</p>


<!-- End wiki content -->

</body>

</html>
